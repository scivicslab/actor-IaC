name: MainSystemInfoWorkflow

steps:
  # Step 1a: Accumulatorが既に存在する場合はスキップ
  - states: ["0", "1"]
    actions:
      - actor: nodeGroup
        method: hasAccumulator

  # Step 1b: Accumulatorがない場合は作成
  - states: ["0", "1"]
    actions:
      - actor: nodeGroup
        method: createAccumulator
        arguments:
          - streaming

  # Step 2a: inventory指定時はグループ名でノード作成
  - states: ["1", "2"]
    actions:
      - actor: nodeGroup
        method: hasInventory
      - actor: nodeGroup
        method: createNodeActors
        arguments:
          - testserver

  # Step 2b: inventoryなしの場合はローカルノード作成
  - states: ["1", "2"]
    actions:
      - actor: nodeGroup
        method: createNodeActors
        arguments:
          - local

  # Step 3: Run system-info workflow on all nodes
  - states: ["2", "3"]
    actions:
      - actor: nodeGroup
        method: apply
        arguments:
          actor: "node-*"
          method: runWorkflow
          arguments: ["system-info.yaml"]

  # Step 4: Get accumulator summary
  - states: ["3", "end"]
    actions:
      - actor: nodeGroup
        method: getAccumulatorSummary
